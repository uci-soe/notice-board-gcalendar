import format from "date-fns/format";
import isToday from "date-fns/is_today";
import isTomorrow from "date-fns/is_tomorrow";
import isMonday from "date-fns/is_monday";
import isTuesday from "date-fns/is_tuesday";
import isWednesday from "date-fns/is_wednesday";
import isThursday from "date-fns/is_thursday";
import isFriday from "date-fns/is_friday";
import isSaturday from "date-fns/is_saturday";
import isSunday from "date-fns/is_sunday";
import axios from 'axios';
import startOfToday from "date-fns/start_of_today";
import addDays from "date-fns/add_days";
import addMinutes from "date-fns/add_minutes";
import subMinutes from "date-fns/sub_minutes";
import parse from "date-fns/parse";
import withinRange from "date-fns/is_within_range";
export const MINUTE = 1000 * 60;
export const MS_IN_DAY = MINUTE * 60 * 24;
export { format, isToday, isTomorrow, isTodayTomorrow, withinRange, addMinutes, subMinutes };
export function formatDescription(desc) {
  if (desc) {
    const clean = desc.replace(/<[^>]*>?/gm, '').replace(/[^a-z\d:.,?!@&\s\n]+/ig, '').split(/\n/g).map(s => s.trim()).filter(s => !!s);
    return clean[0];
  } else {
    return '';
  }
}
export function displayTime(startTime, endTime) {
  return startTime ? `${format(startTime, "h:mm A")} - ${format(endTime, "h:mm A")}` : `All Day`;
}
export function displayHRDate(dateTime, date) {
  return dateTime ? format(dateTime, "MMMM DD") : format(date, "MMMM DD");
}

function displayDayOfWeek(date) {
  if (isMonday(date)) {
    return 'Monday';
  } else if (isTuesday(date)) {
    return 'Tuesday';
  } else if (isWednesday(date)) {
    return 'Wednesday';
  } else if (isThursday(date)) {
    return 'Thursday';
  } else if (isFriday(date)) {
    return 'Friday';
  } else if (isSaturday(date)) {
    return 'Saturday';
  } else if (isSunday(date)) {
    return 'Sunday';
  }
}

export function displayTodayTomorrow(dateTime, date) {
  const test = dateTime || date;

  if (isToday(test)) {
    return 'Today';
  } else if (isTomorrow(test)) {
    return 'Tomorrow';
  } else {
    return displayDayOfWeek(test);
  }
}
export function getEvents(min, max, ID, KEY) {
  const URL = `https://www.googleapis.com/calendar/v3/calendars/${ID}/events`;
  return axios.get(URL, {
    params: {
      key: KEY,
      orderBy: 'startTime',
      timeMin: min.toISOString(),
      timeMax: max.toISOString(),
      singleEvents: true
    }
  }).then(resp => resp.data.items);
}
export function getDate(days) {
  return new Date(Date.now() + MS_IN_DAY * days);
}

function isTodayTomorrow(dateTime, date) {
  const test = dateTime || date;
  return isToday(test) || isTomorrow(test);
}

function nextWorkingDay(date) {
  let result = addDays(date, 1);

  while (isSaturday(result) || isSunday(result)) {
    result = addDays(result, 1);
  }

  return result;
}

export function setDays(events, days) {
  const todayAndTmr = events.filter(function (e) {
    // const now = new Date(Date.now());
    // const start = e.start.dateTime || e.start.date;
    // const end = e.end.dateTime || e.end.date;
    const nextDay = nextWorkingDay(e); // return withinRange(now, start, end) || isTodayTomorrow(nextDay);

    return isTodayTomorrow(nextDay);
  });

  if (todayAndTmr.length < 5) {
    const today = startOfToday();
    const maxDays = addDays(today, days);
    return events.filter(function (e) {
      const date = e.start.dateTime ? e.start.dateTime : parse(e.start.date);
      return withinRange(date, today, maxDays);
    });
  }

  return todayAndTmr;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL2xpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJmb3JtYXQiLCJpc1RvZGF5IiwiaXNUb21vcnJvdyIsImlzTW9uZGF5IiwiaXNUdWVzZGF5IiwiaXNXZWRuZXNkYXkiLCJpc1RodXJzZGF5IiwiaXNGcmlkYXkiLCJpc1NhdHVyZGF5IiwiaXNTdW5kYXkiLCJheGlvcyIsInN0YXJ0T2ZUb2RheSIsImFkZERheXMiLCJhZGRNaW51dGVzIiwic3ViTWludXRlcyIsInBhcnNlIiwid2l0aGluUmFuZ2UiLCJNSU5VVEUiLCJNU19JTl9EQVkiLCJpc1RvZGF5VG9tb3Jyb3ciLCJmb3JtYXREZXNjcmlwdGlvbiIsImRlc2MiLCJjbGVhbiIsInJlcGxhY2UiLCJzcGxpdCIsIm1hcCIsInMiLCJ0cmltIiwiZmlsdGVyIiwiZGlzcGxheVRpbWUiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiZGlzcGxheUhSRGF0ZSIsImRhdGVUaW1lIiwiZGF0ZSIsImRpc3BsYXlEYXlPZldlZWsiLCJkaXNwbGF5VG9kYXlUb21vcnJvdyIsInRlc3QiLCJnZXRFdmVudHMiLCJtaW4iLCJtYXgiLCJJRCIsIktFWSIsIlVSTCIsImdldCIsInBhcmFtcyIsImtleSIsIm9yZGVyQnkiLCJ0aW1lTWluIiwidG9JU09TdHJpbmciLCJ0aW1lTWF4Iiwic2luZ2xlRXZlbnRzIiwidGhlbiIsInJlc3AiLCJkYXRhIiwiaXRlbXMiLCJnZXREYXRlIiwiZGF5cyIsIkRhdGUiLCJub3ciLCJuZXh0V29ya2luZ0RheSIsInJlc3VsdCIsInNldERheXMiLCJldmVudHMiLCJ0b2RheUFuZFRtciIsImUiLCJuZXh0RGF5IiwibGVuZ3RoIiwidG9kYXkiLCJtYXhEYXlzIiwic3RhcnQiXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLE1BQVAsTUFBbUIsaUJBQW5CO0FBQ0EsT0FBT0MsT0FBUCxNQUFvQixtQkFBcEI7QUFDQSxPQUFPQyxVQUFQLE1BQXVCLHNCQUF2QjtBQUNBLE9BQU9DLFFBQVAsTUFBcUIsb0JBQXJCO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQixxQkFBdEI7QUFDQSxPQUFPQyxXQUFQLE1BQXdCLHVCQUF4QjtBQUNBLE9BQU9DLFVBQVAsTUFBdUIsc0JBQXZCO0FBQ0EsT0FBT0MsUUFBUCxNQUFxQixvQkFBckI7QUFDQSxPQUFPQyxVQUFQLE1BQXVCLHNCQUF2QjtBQUNBLE9BQU9DLFFBQVAsTUFBcUIsb0JBQXJCO0FBQ0EsT0FBT0MsS0FBUCxNQUFrQixPQUFsQjtBQUNBLE9BQU9DLFlBQVAsTUFBeUIseUJBQXpCO0FBQ0EsT0FBT0MsT0FBUCxNQUFvQixtQkFBcEI7QUFDQSxPQUFPQyxVQUFQLE1BQXVCLHNCQUF2QjtBQUNBLE9BQU9DLFVBQVAsTUFBdUIsc0JBQXZCO0FBQ0EsT0FBT0MsS0FBUCxNQUFrQixnQkFBbEI7QUFDQSxPQUFPQyxXQUFQLE1BQXdCLDBCQUF4QjtBQUVBLE9BQU8sTUFBTUMsTUFBTSxHQUFHLE9BQU8sRUFBdEI7QUFDUCxPQUFPLE1BQU1DLFNBQVMsR0FBR0QsTUFBTSxHQUFHLEVBQVQsR0FBYyxFQUFoQztBQUNQLFNBQVFqQixNQUFSLEVBQWdCQyxPQUFoQixFQUF5QkMsVUFBekIsRUFBcUNpQixlQUFyQyxFQUFzREgsV0FBdEQsRUFBbUVILFVBQW5FLEVBQStFQyxVQUEvRTtBQUVBLE9BQU8sU0FBU00saUJBQVQsQ0FBMkJDLElBQTNCLEVBQWlDO0FBQ3RDLE1BQUlBLElBQUosRUFBVTtBQUNSLFVBQU1DLEtBQUssR0FBR0QsSUFBSSxDQUNmRSxPQURXLENBQ0gsWUFERyxFQUNXLEVBRFgsRUFFWEEsT0FGVyxDQUVILHdCQUZHLEVBRXVCLEVBRnZCLEVBR1hDLEtBSFcsQ0FHTCxLQUhLLEVBSVhDLEdBSlcsQ0FJUEMsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLElBQUYsRUFKRSxFQUtYQyxNQUxXLENBS0pGLENBQUMsSUFBSSxDQUFDLENBQUNBLENBTEgsQ0FBZDtBQU1BLFdBQU9KLEtBQUssQ0FBQyxDQUFELENBQVo7QUFDRCxHQVJELE1BU0s7QUFDSCxXQUFPLEVBQVA7QUFDRDtBQUNGO0FBRUQsT0FBTyxTQUFTTyxXQUFULENBQXFCQyxTQUFyQixFQUFnQ0MsT0FBaEMsRUFBeUM7QUFDOUMsU0FBT0QsU0FBUyxHQUFJLEdBQUU5QixNQUFNLENBQUM4QixTQUFELEVBQVksUUFBWixDQUFzQixNQUFLOUIsTUFBTSxDQUFDK0IsT0FBRCxFQUFVLFFBQVYsQ0FBb0IsRUFBakUsR0FBc0UsU0FBdEY7QUFDRDtBQUVELE9BQU8sU0FBU0MsYUFBVCxDQUF1QkMsUUFBdkIsRUFBaUNDLElBQWpDLEVBQXVDO0FBQzVDLFNBQU9ELFFBQVEsR0FBR2pDLE1BQU0sQ0FBQ2lDLFFBQUQsRUFBVyxTQUFYLENBQVQsR0FBaUNqQyxNQUFNLENBQUNrQyxJQUFELEVBQU8sU0FBUCxDQUF0RDtBQUNEOztBQUVELFNBQVNDLGdCQUFULENBQTBCRCxJQUExQixFQUFnQztBQUM5QixNQUFJL0IsUUFBUSxDQUFDK0IsSUFBRCxDQUFaLEVBQW9CO0FBQ2xCLFdBQU8sUUFBUDtBQUNELEdBRkQsTUFHSyxJQUFJOUIsU0FBUyxDQUFDOEIsSUFBRCxDQUFiLEVBQXFCO0FBQ3hCLFdBQU8sU0FBUDtBQUNELEdBRkksTUFHQSxJQUFJN0IsV0FBVyxDQUFDNkIsSUFBRCxDQUFmLEVBQXVCO0FBQzFCLFdBQU8sV0FBUDtBQUNELEdBRkksTUFHQSxJQUFJNUIsVUFBVSxDQUFDNEIsSUFBRCxDQUFkLEVBQXNCO0FBQ3pCLFdBQU8sVUFBUDtBQUNELEdBRkksTUFHQSxJQUFJM0IsUUFBUSxDQUFDMkIsSUFBRCxDQUFaLEVBQW9CO0FBQ3ZCLFdBQU8sUUFBUDtBQUNELEdBRkksTUFHQSxJQUFJMUIsVUFBVSxDQUFDMEIsSUFBRCxDQUFkLEVBQXNCO0FBQ3pCLFdBQU8sVUFBUDtBQUNELEdBRkksTUFHQSxJQUFJekIsUUFBUSxDQUFDeUIsSUFBRCxDQUFaLEVBQW9CO0FBQ3ZCLFdBQU8sUUFBUDtBQUNEO0FBQ0Y7O0FBRUQsT0FBTyxTQUFTRSxvQkFBVCxDQUE4QkgsUUFBOUIsRUFBd0NDLElBQXhDLEVBQThDO0FBQ25ELFFBQU1HLElBQUksR0FBR0osUUFBUSxJQUFJQyxJQUF6Qjs7QUFDQSxNQUFJakMsT0FBTyxDQUFDb0MsSUFBRCxDQUFYLEVBQW1CO0FBQ2pCLFdBQU8sT0FBUDtBQUNELEdBRkQsTUFHSyxJQUFJbkMsVUFBVSxDQUFDbUMsSUFBRCxDQUFkLEVBQXNCO0FBQ3pCLFdBQU8sVUFBUDtBQUNELEdBRkksTUFHQTtBQUNILFdBQU9GLGdCQUFnQixDQUFDRSxJQUFELENBQXZCO0FBQ0Q7QUFDRjtBQUVELE9BQU8sU0FBU0MsU0FBVCxDQUFtQkMsR0FBbkIsRUFBd0JDLEdBQXhCLEVBQTZCQyxFQUE3QixFQUFpQ0MsR0FBakMsRUFBc0M7QUFDM0MsUUFBTUMsR0FBRyxHQUFJLG9EQUFtREYsRUFBRyxTQUFuRTtBQUNBLFNBQU8vQixLQUFLLENBQUNrQyxHQUFOLENBQVVELEdBQVYsRUFBZTtBQUNwQkUsSUFBQUEsTUFBTSxFQUFFO0FBQ05DLE1BQUFBLEdBQUcsRUFBRUosR0FEQztBQUVOSyxNQUFBQSxPQUFPLEVBQUUsV0FGSDtBQUdOQyxNQUFBQSxPQUFPLEVBQUVULEdBQUcsQ0FBQ1UsV0FBSixFQUhIO0FBSU5DLE1BQUFBLE9BQU8sRUFBRVYsR0FBRyxDQUFDUyxXQUFKLEVBSkg7QUFLTkUsTUFBQUEsWUFBWSxFQUFFO0FBTFI7QUFEWSxHQUFmLEVBU0pDLElBVEksQ0FTQ0MsSUFBSSxJQUFJQSxJQUFJLENBQUNDLElBQUwsQ0FBVUMsS0FUbkIsQ0FBUDtBQVVEO0FBRUQsT0FBTyxTQUFTQyxPQUFULENBQWlCQyxJQUFqQixFQUF1QjtBQUM1QixTQUFPLElBQUlDLElBQUosQ0FBU0EsSUFBSSxDQUFDQyxHQUFMLEtBQWN6QyxTQUFTLEdBQUd1QyxJQUFuQyxDQUFQO0FBQ0Q7O0FBRUQsU0FBU3RDLGVBQVQsQ0FBeUJjLFFBQXpCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUN2QyxRQUFNRyxJQUFJLEdBQUdKLFFBQVEsSUFBSUMsSUFBekI7QUFDQSxTQUFPakMsT0FBTyxDQUFDb0MsSUFBRCxDQUFQLElBQWlCbkMsVUFBVSxDQUFDbUMsSUFBRCxDQUFsQztBQUNEOztBQUVELFNBQVN1QixjQUFULENBQXdCMUIsSUFBeEIsRUFBOEI7QUFDNUIsTUFBSTJCLE1BQU0sR0FBR2pELE9BQU8sQ0FBQ3NCLElBQUQsRUFBTyxDQUFQLENBQXBCOztBQUNFLFNBQU8xQixVQUFVLENBQUNxRCxNQUFELENBQVYsSUFBc0JwRCxRQUFRLENBQUNvRCxNQUFELENBQXJDLEVBQStDO0FBQzdDQSxJQUFBQSxNQUFNLEdBQUdqRCxPQUFPLENBQUNpRCxNQUFELEVBQVMsQ0FBVCxDQUFoQjtBQUNEOztBQUNILFNBQU9BLE1BQVA7QUFDRDs7QUFFRCxPQUFPLFNBQVNDLE9BQVQsQ0FBaUJDLE1BQWpCLEVBQXlCTixJQUF6QixFQUErQjtBQUNwQyxRQUFNTyxXQUFXLEdBQUdELE1BQU0sQ0FBQ25DLE1BQVAsQ0FBYyxVQUFTcUMsQ0FBVCxFQUFZO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLFVBQU1DLE9BQU8sR0FBR04sY0FBYyxDQUFDSyxDQUFELENBQTlCLENBSjRDLENBSzVDOztBQUNBLFdBQU85QyxlQUFlLENBQUMrQyxPQUFELENBQXRCO0FBQ0QsR0FQbUIsQ0FBcEI7O0FBU0EsTUFBSUYsV0FBVyxDQUFDRyxNQUFaLEdBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFVBQU1DLEtBQUssR0FBR3pELFlBQVksRUFBMUI7QUFDQSxVQUFNMEQsT0FBTyxHQUFHekQsT0FBTyxDQUFDd0QsS0FBRCxFQUFRWCxJQUFSLENBQXZCO0FBQ0EsV0FBT00sTUFBTSxDQUFDbkMsTUFBUCxDQUFjLFVBQVVxQyxDQUFWLEVBQWE7QUFDaEMsWUFBTS9CLElBQUksR0FBRytCLENBQUMsQ0FBQ0ssS0FBRixDQUFRckMsUUFBUixHQUFtQmdDLENBQUMsQ0FBQ0ssS0FBRixDQUFRckMsUUFBM0IsR0FBc0NsQixLQUFLLENBQUNrRCxDQUFDLENBQUNLLEtBQUYsQ0FBUXBDLElBQVQsQ0FBeEQ7QUFDQSxhQUFPbEIsV0FBVyxDQUFDa0IsSUFBRCxFQUFPa0MsS0FBUCxFQUFjQyxPQUFkLENBQWxCO0FBQ0QsS0FITSxDQUFQO0FBSUQ7O0FBQ0QsU0FBT0wsV0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZvcm1hdCBmcm9tIFwiZGF0ZS1mbnMvZm9ybWF0XCI7XHJcbmltcG9ydCBpc1RvZGF5IGZyb20gXCJkYXRlLWZucy9pc190b2RheVwiO1xyXG5pbXBvcnQgaXNUb21vcnJvdyBmcm9tIFwiZGF0ZS1mbnMvaXNfdG9tb3Jyb3dcIjtcclxuaW1wb3J0IGlzTW9uZGF5IGZyb20gXCJkYXRlLWZucy9pc19tb25kYXlcIjtcclxuaW1wb3J0IGlzVHVlc2RheSBmcm9tIFwiZGF0ZS1mbnMvaXNfdHVlc2RheVwiO1xyXG5pbXBvcnQgaXNXZWRuZXNkYXkgZnJvbSBcImRhdGUtZm5zL2lzX3dlZG5lc2RheVwiO1xyXG5pbXBvcnQgaXNUaHVyc2RheSBmcm9tIFwiZGF0ZS1mbnMvaXNfdGh1cnNkYXlcIjtcclxuaW1wb3J0IGlzRnJpZGF5IGZyb20gXCJkYXRlLWZucy9pc19mcmlkYXlcIjtcclxuaW1wb3J0IGlzU2F0dXJkYXkgZnJvbSBcImRhdGUtZm5zL2lzX3NhdHVyZGF5XCI7XHJcbmltcG9ydCBpc1N1bmRheSBmcm9tIFwiZGF0ZS1mbnMvaXNfc3VuZGF5XCI7XHJcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XHJcbmltcG9ydCBzdGFydE9mVG9kYXkgZnJvbSBcImRhdGUtZm5zL3N0YXJ0X29mX3RvZGF5XCI7XHJcbmltcG9ydCBhZGREYXlzIGZyb20gXCJkYXRlLWZucy9hZGRfZGF5c1wiO1xyXG5pbXBvcnQgYWRkTWludXRlcyBmcm9tIFwiZGF0ZS1mbnMvYWRkX21pbnV0ZXNcIjtcclxuaW1wb3J0IHN1Yk1pbnV0ZXMgZnJvbSBcImRhdGUtZm5zL3N1Yl9taW51dGVzXCI7XHJcbmltcG9ydCBwYXJzZSBmcm9tIFwiZGF0ZS1mbnMvcGFyc2VcIjtcclxuaW1wb3J0IHdpdGhpblJhbmdlIGZyb20gXCJkYXRlLWZucy9pc193aXRoaW5fcmFuZ2VcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBNSU5VVEUgPSAxMDAwICogNjA7XHJcbmV4cG9ydCBjb25zdCBNU19JTl9EQVkgPSBNSU5VVEUgKiA2MCAqIDI0O1xyXG5leHBvcnQge2Zvcm1hdCwgaXNUb2RheSwgaXNUb21vcnJvdywgaXNUb2RheVRvbW9ycm93LCB3aXRoaW5SYW5nZSwgYWRkTWludXRlcywgc3ViTWludXRlc307XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGVzY3JpcHRpb24oZGVzYykge1xyXG4gIGlmIChkZXNjKSB7XHJcbiAgICBjb25zdCBjbGVhbiA9IGRlc2NcclxuICAgICAgLnJlcGxhY2UoLzxbXj5dKj4/L2dtLCAnJylcclxuICAgICAgLnJlcGxhY2UoL1teYS16XFxkOi4sPyFAJlxcc1xcbl0rL2lnLCAnJylcclxuICAgICAgLnNwbGl0KC9cXG4vZylcclxuICAgICAgLm1hcChzID0+IHMudHJpbSgpKVxyXG4gICAgICAuZmlsdGVyKHMgPT4gISFzKTtcclxuICAgIHJldHVybiBjbGVhblswXTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGlzcGxheVRpbWUoc3RhcnRUaW1lLCBlbmRUaW1lKSB7XHJcbiAgcmV0dXJuIHN0YXJ0VGltZSA/IGAke2Zvcm1hdChzdGFydFRpbWUsIFwiaDptbSBBXCIpfSAtICR7Zm9ybWF0KGVuZFRpbWUsIFwiaDptbSBBXCIpfWAgOiBgQWxsIERheWA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkaXNwbGF5SFJEYXRlKGRhdGVUaW1lLCBkYXRlKSB7XHJcbiAgcmV0dXJuIGRhdGVUaW1lID8gZm9ybWF0KGRhdGVUaW1lLCBcIk1NTU0gRERcIikgOiBmb3JtYXQoZGF0ZSwgXCJNTU1NIEREXCIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkaXNwbGF5RGF5T2ZXZWVrKGRhdGUpIHtcclxuICBpZiAoaXNNb25kYXkoZGF0ZSkpIHtcclxuICAgIHJldHVybiAnTW9uZGF5JztcclxuICB9XHJcbiAgZWxzZSBpZiAoaXNUdWVzZGF5KGRhdGUpKSB7XHJcbiAgICByZXR1cm4gJ1R1ZXNkYXknO1xyXG4gIH1cclxuICBlbHNlIGlmIChpc1dlZG5lc2RheShkYXRlKSkge1xyXG4gICAgcmV0dXJuICdXZWRuZXNkYXknO1xyXG4gIH1cclxuICBlbHNlIGlmIChpc1RodXJzZGF5KGRhdGUpKSB7XHJcbiAgICByZXR1cm4gJ1RodXJzZGF5JztcclxuICB9XHJcbiAgZWxzZSBpZiAoaXNGcmlkYXkoZGF0ZSkpIHtcclxuICAgIHJldHVybiAnRnJpZGF5JztcclxuICB9XHJcbiAgZWxzZSBpZiAoaXNTYXR1cmRheShkYXRlKSkge1xyXG4gICAgcmV0dXJuICdTYXR1cmRheSc7XHJcbiAgfVxyXG4gIGVsc2UgaWYgKGlzU3VuZGF5KGRhdGUpKSB7XHJcbiAgICByZXR1cm4gJ1N1bmRheSc7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGlzcGxheVRvZGF5VG9tb3Jyb3coZGF0ZVRpbWUsIGRhdGUpIHtcclxuICBjb25zdCB0ZXN0ID0gZGF0ZVRpbWUgfHwgZGF0ZTtcclxuICBpZiAoaXNUb2RheSh0ZXN0KSkge1xyXG4gICAgcmV0dXJuICdUb2RheSc7XHJcbiAgfVxyXG4gIGVsc2UgaWYgKGlzVG9tb3Jyb3codGVzdCkpIHtcclxuICAgIHJldHVybiAnVG9tb3Jyb3cnO1xyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIHJldHVybiBkaXNwbGF5RGF5T2ZXZWVrKHRlc3QpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEV2ZW50cyhtaW4sIG1heCwgSUQsIEtFWSkge1xyXG4gIGNvbnN0IFVSTCA9IGBodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9jYWxlbmRhci92My9jYWxlbmRhcnMvJHtJRH0vZXZlbnRzYDtcclxuICByZXR1cm4gYXhpb3MuZ2V0KFVSTCwge1xyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGtleTogS0VZLFxyXG4gICAgICBvcmRlckJ5OiAnc3RhcnRUaW1lJyxcclxuICAgICAgdGltZU1pbjogbWluLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHRpbWVNYXg6IG1heC50b0lTT1N0cmluZygpLFxyXG4gICAgICBzaW5nbGVFdmVudHM6IHRydWVcclxuICAgIH1cclxuICB9KVxyXG4gICAgLnRoZW4ocmVzcCA9PiByZXNwLmRhdGEuaXRlbXMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0ZShkYXlzKSB7XHJcbiAgcmV0dXJuIG5ldyBEYXRlKERhdGUubm93KCkgKyAoTVNfSU5fREFZICogZGF5cykpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1RvZGF5VG9tb3Jyb3coZGF0ZVRpbWUsIGRhdGUpIHtcclxuICBjb25zdCB0ZXN0ID0gZGF0ZVRpbWUgfHwgZGF0ZTtcclxuICByZXR1cm4gaXNUb2RheSh0ZXN0KSB8fCBpc1RvbW9ycm93KHRlc3QpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBuZXh0V29ya2luZ0RheShkYXRlKSB7XHJcbiAgbGV0IHJlc3VsdCA9IGFkZERheXMoZGF0ZSwgMSk7XHJcbiAgICB3aGlsZSAoaXNTYXR1cmRheShyZXN1bHQpIHx8IGlzU3VuZGF5KHJlc3VsdCkpIHtcclxuICAgICAgcmVzdWx0ID0gYWRkRGF5cyhyZXN1bHQsIDEpO1xyXG4gICAgfVxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXREYXlzKGV2ZW50cywgZGF5cykge1xyXG4gIGNvbnN0IHRvZGF5QW5kVG1yID0gZXZlbnRzLmZpbHRlcihmdW5jdGlvbihlKSB7XHJcbiAgICAvLyBjb25zdCBub3cgPSBuZXcgRGF0ZShEYXRlLm5vdygpKTtcclxuICAgIC8vIGNvbnN0IHN0YXJ0ID0gZS5zdGFydC5kYXRlVGltZSB8fCBlLnN0YXJ0LmRhdGU7XHJcbiAgICAvLyBjb25zdCBlbmQgPSBlLmVuZC5kYXRlVGltZSB8fCBlLmVuZC5kYXRlO1xyXG4gICAgY29uc3QgbmV4dERheSA9IG5leHRXb3JraW5nRGF5KGUpO1xyXG4gICAgLy8gcmV0dXJuIHdpdGhpblJhbmdlKG5vdywgc3RhcnQsIGVuZCkgfHwgaXNUb2RheVRvbW9ycm93KG5leHREYXkpO1xyXG4gICAgcmV0dXJuIGlzVG9kYXlUb21vcnJvdyhuZXh0RGF5KTtcclxuICB9KTtcclxuXHJcbiAgaWYgKHRvZGF5QW5kVG1yLmxlbmd0aCA8IDUpIHtcclxuICAgIGNvbnN0IHRvZGF5ID0gc3RhcnRPZlRvZGF5KCk7XHJcbiAgICBjb25zdCBtYXhEYXlzID0gYWRkRGF5cyh0b2RheSwgZGF5cyk7XHJcbiAgICByZXR1cm4gZXZlbnRzLmZpbHRlcihmdW5jdGlvbiAoZSkge1xyXG4gICAgICBjb25zdCBkYXRlID0gZS5zdGFydC5kYXRlVGltZSA/IGUuc3RhcnQuZGF0ZVRpbWUgOiBwYXJzZShlLnN0YXJ0LmRhdGUpO1xyXG4gICAgICByZXR1cm4gd2l0aGluUmFuZ2UoZGF0ZSwgdG9kYXksIG1heERheXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiB0b2RheUFuZFRtcjtcclxufSJdfQ==